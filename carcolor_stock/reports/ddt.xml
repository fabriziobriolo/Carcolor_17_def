<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="l10n_it_stock_ddt.action_report_ddt" model="ir.actions.report">
        <field name="name">DDT</field>
        <field name="model">stock.picking</field>
        <field name="report_type">carbone</field>
        <field name="carbone_report_type">pdf</field>
        <field name="report_name">carcolor_stock.report_ddt</field>
        <field name="report_file">report_ddt</field>
        <field name="carbone_template_file" type="base64" file="carcolor_stock/reports/templates/ddt.docx"/>
        <field name="print_report_name">'DDT - %s - %s' % (object.partner_id.name or '', object.l10n_it_ddt_number)</field>
        <field name="carbone_json_data">{
    "number": object.l10n_it_ddt_number,
    "date": object.date_done.strftime('%d/%m/%Y'),
    "transport_method": dict(object.fields_get(allfields=['l10n_it_transport_method'])['l10n_it_transport_method']['selection'])[object.l10n_it_transport_method],
    "transport_reason": dict(object.fields_get(allfields=['l10n_it_transport_reason'])['l10n_it_transport_reason']['selection'])[object.l10n_it_transport_reason],
    "transport_method_details": object.l10n_it_transport_method_details or "",
    "parcels": object.l10n_it_parcels,
    "weight": object.weight,
    "carrier_name": object.carrier_id and object.carrier_id.name or "",
    "client_order": object.sale_id.client_order_ref or "",
    "note": object.note,
    "partner":
        {
            "name": object.partner_id.commercial_partner_id.name or "",
            "street": object.partner_id.commercial_partner_id.street or "",
            "zip": object.partner_id.commercial_partner_id.zip or "",
            "city": object.partner_id.commercial_partner_id.city or "",
            "prov": object.partner_id.commercial_partner_id.state_id.code or "",
            "vat": object.partner_id.commercial_partner_id.vat or "",
            "cf": object.partner_id.commercial_partner_id.l10n_it_codice_fiscale or object.partner_id.commercial_partner_id.vat or "",
            "ref": object.partner_id.commercial_partner_id.ref or ""
        },
    "shipping_address":
        {
            "name": object.partner_id.name or "",
            "street": object.partner_id.street or "",
            "zip": object.partner_id.zip or "",
            "city": object.partner_id.city or "",
            "prov": object.partner_id.state_id.code or "",
            "vat": object.partner_id.vat or "",
            "cf": object.partner_id.l10n_it_codice_fiscale or object.partner_id.vat or "",
            "ref": object.partner_id.ref or ""
        },
    "lines":
        [
            {
                "product":
                    {
                        "name": l.product_id.name,
                        "code": l.product_id.default_code or "",
                        "uom": l.product_uom.name,
                        "qty": l.quantity,
                        "lots": l.lot_ids and ",".join([lot.name for lot in l.lot_ids]) or ""
                    }
            }
            for l in object.move_ids_without_package
        ] if object.move_ids_without_package else [],
    "company":
        {
            "name": object.company_id.name,
            "cf": object.company_id.partner_id.l10n_it_codice_fiscale or object.company_id.partner_id.vat or "",
            "vat": object.company_id.partner_id.vat or "",
            "street": object.company_id.partner_id.street or "",
            "zip": object.company_id.partner_id.zip or "",
            "city": object.company_id.partner_id.city or "",
            "prov": object.company_id.partner_id.state_id.code or "",
            "email": object.company_id.partner_id.email or "",
            "pec": object.company_id.partner_id.l10n_it_pec_email or ""
        }
}
        </field>
    </record>
</odoo>